# –°–µ—Ä–≤–∏—Å—ã —Ä–æ–±–æ—Ç–∞

–î–∞–Ω–Ω–∞—è –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ä–æ–±–æ—Ç–∞ —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º WebSocket –∏ WebRTC —Å–µ—Ä–≤–µ—Ä–æ–º –Ω–∞ Node.js.

## üîÑ –î–≤—É—Ö–ø–æ—Ç–æ—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ **–¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–∞ (–ø–æ—Ç–æ–∫–∞)**:

### üéÆ –ü–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–æ–º
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–µ–º —Ä–æ–±–æ—Ç–∞, –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Pixhawk
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### üìπ –ü–æ—Ç–æ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –≤–∏–¥–µ–æ  
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π –∏ –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫–∞–º–∏
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è USB –∫–∞–º–µ—Ä—ã
  - WebRTC —Å–∏–≥–Ω–∞–ª–∏–Ω–≥
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ —Å–µ—Å—Å–∏—è–º–∏
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∏–¥–µ–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

#### `DualThreadRobotService.cs` - –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
–£–ø—Ä–∞–≤–ª—è–µ—Ç –¥–≤—É—Ö–ø–æ—Ç–æ—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
- –ó–∞–ø—É—Å–∫ –¥–≤—É—Ö –ø–æ—Ç–æ–∫–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤
- –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

```csharp
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
using var service = new DualThreadRobotService();
await service.RunAsync(cancellationToken);
```

#### `RobotControlThread.cs` - –ü–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–æ–º
–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Pixhawk
- –û–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `CommandProcessing`
- –û—Ç–ø—Ä–∞–≤–∫—É —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Pixhawk

#### `VideoStreamingThread.cs` - –ü–æ—Ç–æ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –≤–∏–¥–µ–æ
–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–º–µ—Ä—ã —á–µ—Ä–µ–∑ `VideoStreaming`
- WebRTC —Å–∏–≥–Ω–∞–ª–∏–Ω–≥ —á–µ—Ä–µ–∑ `WebRTC`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–º–µ—Ä—ã
- –û—Ç–ø—Ä–∞–≤–∫—É —Å—Ç–∞—Ç—É—Å–∞ –≤–∏–¥–µ–æ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### `WebSocketClient.cs` - WebSocket –∫–ª–∏–µ–Ω—Ç
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É `193.169.240.11:8080`
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–±–æ—Ç–∞ (`REGISTER!ROBOT`)
- –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

#### `CommandProcessing.cs` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
- –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∏–∫–æ–≤ –≤ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–æ–ª–µ—Å
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Pixhawk
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π

#### `WebRTC.cs` - WebRTC —Å–∏–≥–Ω–∞–ª–∏–Ω–≥
- –û–±—Ä–∞–±–æ—Ç–∫–∞ offer/answer/ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ —Å–µ—Å—Å–∏—è–º–∏
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º

#### `VideoStreaming.cs` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π
- –ü–æ–∏—Å–∫ USB –∫–∞–º–µ—Ä —á–µ—Ä–µ–∑ v4l2
- –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∏–¥–µ–æ —Å—Ç—Ä–∏–º–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `CameraSearch`

#### `RobotService.cs` - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å
- –û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (deprecated)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

### –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `RobotMain.cs`
```csharp
using var dualThreadRobotService = new DualThreadRobotService();
await dualThreadRobotService.RunAsync(cancellationToken);
```

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞:

1. **WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `ws://193.169.240.11:8080`
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–æ–≤**
   - üéÆ –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–æ–º
   - üìπ –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –≤–∏–¥–µ–æ

3. **–ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–∞–±–æ—Ç–∞**
   - –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤–æ–µ–º –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ
   - –û–±—â–µ–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üìä –ü—Ä–æ—Ç–æ–∫–æ–ª—ã —Å–æ–æ–±—â–µ–Ω–∏–π

### WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è
```
REGISTER!ROBOT          - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–±–æ—Ç–∞
COMMAND!{json}          - –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
TELEMETRY!{json}        - –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è —Ä–æ–±–æ—Ç–∞
```

### WebRTC —Å–∏–≥–Ω–∞–ª–∏–Ω–≥
```
offer                   - WebRTC –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
answer                  - WebRTC –æ—Ç–≤–µ—Ç
ice-candidate           - ICE –∫–∞–Ω–¥–∏–¥–∞—Ç
```

### –¢–∏–ø—ã —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
```
robot_control_status    - –°—Ç–∞—Ç—É—Å –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
robot_video_status      - –°—Ç–∞—Ç—É—Å –ø–æ—Ç–æ–∫–∞ –≤–∏–¥–µ–æ (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫)  
robot_dual_thread_status - –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã (–∫–∞–∂–¥—ã–µ 45 —Å–µ–∫)
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### `Config/ServerConfig.cs`
```csharp
public const string SERVER_IP = "193.169.240.11";
public const int SERVER_PORT = 8080;
public static string WebSocketUrl => "ws://193.169.240.11:8080";
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –ø–æ—Ç–æ–∫–æ–≤

### –ü–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–æ–º (RobotControlThread)
```
‚îå‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Pixhawk
‚îú‚îÄ –ó–∞–ø—É—Å–∫ CommandProcessing  
‚îú‚îÄ –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ –¢–∞–π–º–µ—Ä —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (30 —Å–µ–∫)
‚îî‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
```

### –ü–æ—Ç–æ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –≤–∏–¥–µ–æ (VideoStreamingThread)  
```
‚îå‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã
‚îú‚îÄ –ó–∞–ø—É—Å–∫ WebRTC —Å–µ—Ä–≤–∏—Å–∞
‚îú‚îÄ –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –≤–∏–¥–µ–æ
‚îú‚îÄ –¢–∞–π–º–µ—Ä —Å—Ç–∞—Ç—É—Å–∞ –≤–∏–¥–µ–æ (60 —Å–µ–∫)
‚îî‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∏–¥–µ–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
```

## üõ† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–≤—É—Ö–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏:
- **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –°–±–æ–π –≤ –≤–∏–¥–µ–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å**: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ –≤–∏–¥–µ–æ
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –†–∞–∑–¥–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –û–±—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã:
- **WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±–æ–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞**: –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

## üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **WebSocket**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **Pixhawk**: –ü–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- **–ö–∞–º–µ—Ä–∞**: –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ —Å–±–æ–µ
- **WebRTC**: Graceful restart —Å–µ—Å—Å–∏–π

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ö–∞–∂–¥—ã–µ 45 —Å–µ–∫—É–Ω–¥ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ç—É—Å:
```
üìä –°—Ç–∞—Ç—É—Å –ø–æ—Ç–æ–∫–æ–≤: üéÆ Control:‚úÖ | üìπ Video:‚úÖ | üîß Pixhawk:‚úÖ | üì∑ Camera:‚úÖ
```

–ì–¥–µ:
- üéÆ Control - —Å—Ç–∞—Ç—É—Å –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- üìπ Video - —Å—Ç–∞—Ç—É—Å –ø–æ—Ç–æ–∫–∞ –≤–∏–¥–µ–æ  
- üîß Pixhawk - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∞–≤—Ç–æ–ø–∏–ª–æ—Ç—É
- üì∑ Camera - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–º–µ—Ä—ã 